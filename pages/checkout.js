import Head from 'next/head';
import Image from 'next/image';
import Link from 'next/link';
import React, { useMemo, useState } from 'react'
import { AiOutlineHome } from 'react-icons/ai';
import { useSelector } from 'react-redux';

import {
    Banner14,
    Banner15,
    Banner17,
    Banner18,
    Banner19,
    Banner20,
    Banner22,
    Banner23,
    Banner24,
    Banner25,
    Banner26,
    Banner27,
    Banner28,
    Banner29,
    Banner30,
    Banner32,
    Banner33,
    Banner34
} from '../BannerImages/index'
import Banner from '../components/Banner';
import CheckoutProduct from '../components/CheckoutProduct';
import { Footer } from '../components/Footer';
import HeaderItems from '../components/HeaderItems';
import Navbar from '../components/Navbar';
import SubTotal from '../components/SubTotal';
import { getUser } from '../features/authSlice';
import { selectBasketItems } from '../features/basketSlice';

const Checkout = () => {

    const bannerImages = [Banner25, Banner26, Banner27, Banner15, Banner14, Banner17, Banner18, Banner19, Banner20, Banner22, Banner23, Banner24, Banner28, Banner29, Banner30, Banner29, Banner32, Banner33, Banner34]

    const [groupedItemsInBasket, setGroupedItemsInBasket] = useState([])
    const user = useSelector(getUser);
    const basket = useSelector(selectBasketItems);

    useMemo(() => {
        const groupedItems = basket.reduce((results, item) => {
            (results[item.id] = results[item.id] || []).push(item);
            // console.log(results);
            return results;
        }, {});
        setGroupedItemsInBasket(groupedItems)
    }, [basket])

    // console.log(basket);
    return (
        <div className="checkout">
            <Head>
                <title>Checkout</title>
                <meta name="description" content="Generated by create next app" />
                <link rel="icon" href="/favicon.ico" />
            </Head>
            <Navbar />
            <HeaderItems />
            <Banner images={bannerImages} />
            <div className="relative top-[18rem] md:top-[20rem] py-8">
                <div className="flex flex-col items-center justify-center ">
                    <div className="flex flex-col text-center md:mt-[6rem] lg:mt-[8rem] py-4">
                        <h3 className="text-xl font-bold">Hello, {user ? user.email : "Guest"}</h3>
                        <h2 className="text-lg font-semibold mt-2 ">
                            {basket.length === 0 ? "No Product added - Empty Cart" : (
                                <div className="flex gap-2 text-xl items-center justify-center text-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-10 h-10">
                                        <path strokeLinecap="round" strokeLinejoin="round" d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 00-3 3h15.75m-12.75-3h11.218c1.121-2.3 2.1-4.684 2.924-7.138a60.114 60.114 0 00-16.536-1.84M7.5 14.25L5.106 5.272M6 20.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm12.75 0a.75.75 0 11-1.5 0 .75.75 0 011.5 0z" />
                                    </svg>
                                    <span className="font-semibold text-[#fcba03]">Cart</span>
                                </div>
                            )}
                        </h2>
                        {basket.length === 0 && (<Image src="https://m.media-amazon.com/images/G/31/cart/empty/kettle-desaturated._CB424694257_.svg" height="400" width="400" className="mt-10" />)}
                    </div>
                    <div className="flex flex-col py-8 mt-8">
                        {Object.entries(groupedItemsInBasket).map(([key, items]) => (

                            < CheckoutProduct
                                key={key}
                                id={items[0].id}
                                title={items[0].title}
                                image={items[0].image}
                                price={items[0].price}
                                rating={items[0].rating}
                                details={items[0].detail}
                                quantity={items.length}
                            />

                        ))}
                    </div>
                    {basket.length === 0 && <Link href='/' className="authButton w-[15rem] text-xl font-semibold mb-16">Go To Home <span className="ml-2 my-auto"><AiOutlineHome /></span></Link>}
                </div>
            </div>
            <div className="">
                <SubTotal />
            </div>
            <div className="relative bottom-0 mt-60">
                <Footer />
            </div>

        </div>
    )
}

export default Checkout